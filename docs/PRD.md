# 우리아이 픽업이모 (MVP v1.0 PRD)
-- Cursor 개발용 / 코드 꼬임 최소화 버전 (Single Source of Truth)

> 📌 PRD 사용 원칙 (개발 고정 규칙)
> - 이 문서는 Cursor에서 실제 개발 시 기준이 되는 단일 기준 문서이다.
> - MVP v1.0 개발 중에는 이 문서의 규칙을 변경하지 않는다.
> - 기능 추가/정책 변경은 Post-Launch Plan에만 기록한다.
> - 구현이 헷갈릴 경우 “Trip / Invitation / 상태 전이 규칙”을 최우선으로 따른다.

---

## 1. Overview

### Problem Statement

**문제 정의**  
맞벌이 가정의 학부모는 초등학교 자녀의 하교 및 학원 이동을 직접 담당하지 못하는 상황에서 지속적인 스트레스와 불안감을 겪고 있다.  
반면, 같은 학교에 자녀를 둔 일부 학부모는 상대적으로 여유가 있음에도 이를 활용할 안전하고 신뢰 가능한 공식 채널이 없다.

**왜 중요한가**  
아동의 이동 안전은 타협할 수 없는 문제이며, 특히 초등학생의 하교 시간대는 보호 공백이 자주 발생한다.  
이로 인한 불안은 부모의 삶의 질과 직결되며, 장기적으로는 직장 유지·출산·육아 결정에도 영향을 준다.

**타겟 고객**  
- 요청자: 초등학교 자녀를 둔 맞벌이 학부모  
- 제공자: 부가 소득 또는 지역 활동 목적의 동일 학교 학부모

**핵심 전제/가정**  
- 같은 학교 학부모 간 신뢰는 외부인보다 높다  
- 사진 인증 + 상태 공유만으로도 불안은 충분히 감소한다  
- MVP에서는 자동화보다 **명확한 규칙과 안정성**이 우선이다

---

## 2. Proposed Work

### 솔루션 개요

본 서비스는 **제공자 초대 기반 단방향 매칭**으로 운영되는  
초등학교 학부모 전용 픽업 웹앱(Web App) 플랫폼이다.

MVP 범위:
- 실시간 위치 공유 ❌
- 지도 기반 출발지·목적지 검색 및 좌표 저장 ⭕
- 모바일 웹앱 형태로 제공 ⭕

---

### 핵심 기능

- 픽업 요청 등록 (출발지·목적지·시간)
- 픽업 제공자 등록 및 인증 (서류 업로드 + 관리자 승인)
- 요청자 리스트 제공 (제공자 초대용)
  - 노출 정보: 시간대, 대략 위치(동/구), 목적지 유형
  - 정확한 주소/좌표는 **초대 수락 후** 공개
- 픽업 상태 관리
  `(REQUESTED → MATCHED → IN_PROGRESS → ARRIVED → COMPLETED / CANCELLED)`
- 사진 인증, 푸시 알림, 평가

※ `MATCHED`는 **요청자가 제공자의 초대를 수락하여 Trip에 포함된 상태**를 의미한다.

---

## 3. 사용자 플로우 (단방향 초대 고정)

### 요청자
픽업 요청 등록  
→ 제공자의 초대 대기  
→ 초대 수신  
→ 초대 수락 또는 거절  
→ 픽업 진행  
→ 도착 사진 확인  
→ 평가 전송

### 제공자
인증 완료  
→ 요청자 리스트 확인  
→ 픽업 초대 전송  
→ 수락 대기  
→ (수락 시) 매칭 인원 +1  
→ 최대 3명까지 반복  
→ 출발 버튼 클릭  
→ IN_PROGRESS (Trip LOCK)  
→ 도착 후 사진 업로드 → ARRIVED

---

## 4. 핵심 엔지니어링 규칙 (절대 기준)

### 상태(enum) 규칙

- 상태(enum)는 **Trip 단위 상태만** 표현한다
- 초대 상태는 enum이 아닌 **Invitation 데이터**로 관리한다
- Invitation 상태:
  `PENDING / ACCEPTED / REJECTED / EXPIRED`

상태 전이:
- REQUESTED: 픽업 요청 생성됨
- MATCHED: 초대 ACCEPTED → Trip에 포함
- IN_PROGRESS: 제공자가 출발 버튼 클릭 (LOCK)
- ARRIVED: 도착 사진 업로드 완료
- COMPLETED: 평가 제출 완료 또는 자동 완료
- CANCELLED: 취소 또는 노쇼

---

### Invitation 규칙 (서버/DB 강제)

- 요청자는 동시에 **PENDING 초대 1개만 허용**
- 제공자는 **수락된 인원이 3명 미만일 때만** 초대 가능
- 초대는 유효시간 경과 시 자동 `EXPIRED`
- 초대 관련 제한은 **프론트가 아닌 서버/DB에서 강제**

---

### Trip 규칙 (픽업 세션)

- 픽업은 제공자의 **1회 출발 단위 = Trip**
- Trip은 `capacity = 3`
- 초대 ACCEPT 시점에 서버/DB에서 capacity 초과를 차단한다

---

### Trip LOCK 규칙

- 출발 버튼 클릭 시 Trip은 LOCK 상태가 된다
- LOCK 이후:
  - 추가 초대 불가
  - 초대 수락 불가
  - 남아있는 모든 `PENDING` 초대는 즉시 `EXPIRED` 처리

---

### 평가 / 완료 규칙

- 사진 업로드 → ARRIVED
- 평가 제출 → COMPLETED
- ARRIVED 후 **24시간 내 평가 없으면 자동 COMPLETED**

---

### 취소 / 노쇼 규칙

- 취소와 노쇼는 모두 `CANCELLED` 상태로 처리
- 단, `reason_code`로 구분:
  - CANCEL
  - NO_SHOW
- MVP에서는 패널티 없음 (기록만 유지)

---

## 5. Decision / Risk

- 아동 안전 사고: 인증 + 사진 + 기록으로 대응
- 허위 학부모: 서류 + 관리자 승인
- 노쇼: 기록만 남기고 패널티 없음
- 광고: 픽업 기능과 완전히 분리

---

## 6. Dependencies

### 외부 서비스
- 지도 API (좌표 검색/저장)
- 푸시 알림
- 결제 시스템 (v2)

### 데이터 정책
- 인증 서류: 승인 후 30일 보관 후 삭제
- 인증 서류 접근: 관리자만 가능

---

## 7. Success Criteria

### 핵심 지표
- 월 매칭 성공 건수: 3개월 내 100건
- 요청자 재사용률: 40% 이상
- 평균 평점: 4.5 이상

---

## 8. Definition of Done

### 필수
- 상태/초대/LOCK/capacity 서버 강제
- 초대 중복/과매칭 불가
- 픽업 기록 누락 없음
- 모바일 웹 UX 정상

### 출시 가능
- UI 고도화
- 자동 매칭

### 출시 불가
- 인증 우회
- 상태 전이 누락

---

## 9. Nope (MVP 제외)

- 요청자 → 제공자 요청
- 즉시 호출형 픽업
- 외부인 참여
- 패널티/벌점
- 광고 등록 기능

---

## 10. Post-Launch Plan

### v1.1
- 마이페이지 이력
- 관리자 승인 개선

### v2
- 결제
- 중·고등학교 확장
- 실시간 위치 공유
- 광고 페이지

### v3+
- 학원 기반 픽업
- 지역 기반 등·하교
- 지자체 협력

---

## Change Log
- 2025-01-XX: Cursor 개발 기준 PRD 확정
- 2025-01-XX: 초대/Trip/LOCK/capacity 충돌 제거
- 2025-01-XX: 노쇼/취소/평가 규칙 고정
ㅗ