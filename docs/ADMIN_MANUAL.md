# 관리자 매뉴얼 (Admin Manual)

## 1. 개요
이 문서는 "우리아이 픽업이모" 서비스의 관리자 대시보드 사용 방법을 설명합니다.
관리자 대시보드는 서비스 현황 파악, 제공자 서류 승인, 그리고 비상 상황 시 픽업 상태를 강제로 제어하는 기능을 제공합니다.

## 2. 접속 방법
- **URL**: `/admin`
- **권한**: `ADMIN` 역할을 가진 사용자만 접근 가능합니다.

### 관리자 권한 부여 방법
현재는 DB에서 직접 권한을 부여해야 합니다. Supabase SQL Editor에서 아래 명령어를 실행하세요.

```sql
-- 특정 사용자에게 관리자 권한 부여
UPDATE profiles 
SET role = 'ADMIN' 
WHERE clerk_user_id = 'USER_ID_HERE';
```

## 3. 주요 기능

### 3.1 대시보드 홈 (`/admin`)
- **전체 통계**: 전체 회원 수, 승인 대기 서류 수, 현재 운행 중인 Trip 수를 한눈에 볼 수 있습니다.
- **학교별 통계**: 각 학교별 픽업 요청 수, 제공자 수, 매칭률을 테이블 형태로 제공합니다.

### 3.2 서류 승인 관리 (`/admin/approvals`)
- **목록 조회**: 승인 대기 중인(`PENDING`) 제공자 서류 목록을 최신순으로 보여줍니다.
- **상세 검토**:
  - '검토하기' 버튼을 누르면 서류 이미지를 확대하여 볼 수 있습니다.
  - 제출자의 학교 정보와 ID 등을 확인할 수 있습니다.
- **승인/거절**:
  - **승인**: 서류가 유효하면 '승인하기'를 클릭합니다. 상태가 `APPROVED`로 변경됩니다.
  - **거절**: 서류가 부적합하면 '거절하기'를 클릭하고 사유를 입력합니다. 자주 사용하는 거절 사유(흐릿함, 정보 불일치 등)를 선택할 수 있습니다. 상태가 `REJECTED`로 변경됩니다.
- **자동 삭제**: 승인된 서류는 개인정보 보호를 위해 30일 후 자동으로 삭제됩니다 (스케줄러 연동 필요).

### 3.3 비상 상태 제어 (Emergency Override)
- **위치**: 각 픽업(Trip) 상세 페이지 (`/trips/[id]`)
- **기능**: 시스템 오류나 사용자 실수로 인해 픽업 상태가 꼬였을 때, 관리자가 강제로 상태를 변경할 수 있습니다.
- **사용법**:
  1. 관리자 계정으로 Trip 상세 페이지에 접속합니다.
  2. 페이지 상단에 붉은색 테두리의 "관리자 비상 제어" 패널이 표시됩니다.
  3. 변경할 상태를 선택하고 "변경 적용" 버튼을 누릅니다.
  4. **주의**: 상태 변경 시 관련 데이터(LOCK 여부, 타임스탬프 등)도 함께 변경되므로 신중하게 사용해야 합니다.

## 4. 문제 해결
- **권한 오류**: `/admin` 접속 시 홈으로 리다이렉트된다면 DB의 `role` 컬럼이 `ADMIN`인지 확인하세요.
- **이미지 로딩 실패**: 서류 이미지가 보이지 않는 경우 Supabase Storage의 권한 설정이나 경로를 확인하세요.
