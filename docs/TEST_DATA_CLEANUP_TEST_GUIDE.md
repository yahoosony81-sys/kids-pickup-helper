# 테스트 데이터 정리 검증 가이드

## 개요
이 문서는 테스트 픽업 그룹 정리 기능이 올바르게 작동하는지 검증하기 위한 테스트 시나리오를 제공합니다.

## 사전 준비
1. 데이터베이스 마이그레이션 실행 확인
   - `supabase/migrations/20260110120000_add_is_test_to_trips.sql` 실행 완료
   - `trips` 테이블에 `is_test` 컬럼이 추가되었는지 확인

2. 테스트 카드 마킹 실행
   - `docs/TEST_DATA_CLEANUP.md`의 SQL을 실행하여 내 계정의 테스트 카드를 마킹
   - 마킹된 테스트 카드가 있는지 확인

## 테스트 시나리오

### 시나리오 1: 제공하기 화면에서 테스트 카드 안 보임
**목표**: 픽업 제공하기 화면에서 테스트 카드가 표시되지 않는지 확인

**절차**:
1. `/trips/new` 페이지로 이동
2. 달력이 표시되는지 확인
3. 테스트 카드가 달력에 집계되지 않는지 확인
4. `/trips` 페이지로 이동하여 진행중 Trip 목록 확인
5. 테스트 카드가 목록에 표시되지 않는지 확인

**예상 결과**:
- 제공하기 화면의 달력에 테스트 카드가 집계되지 않음
- 진행중 Trip 목록에 테스트 카드가 표시되지 않음

---

### 시나리오 2: 마이페이지 캘린더에서 테스트 카드 집계됨
**목표**: 마이페이지 제공 이력 캘린더에서 테스트 카드가 날짜별로 집계되는지 확인

**절차**:
1. `/my` 페이지로 이동
2. "제공 이력" 탭 선택
3. 캘린더 뷰로 전환
4. 테스트 카드가 있는 날짜를 확인
5. 해당 날짜에 건수가 표시되는지 확인

**예상 결과**:
- 테스트 카드의 `scheduled_start_at` 날짜에 건수가 집계됨
- 날짜별 집계가 정확하게 표시됨

---

### 시나리오 3: 날짜 클릭 시 테스트 카드 리스트 표시
**목표**: 마이페이지 캘린더에서 날짜를 클릭했을 때 테스트 카드가 리스트에 포함되는지 확인

**절차**:
1. `/my` 페이지로 이동
2. "제공 이력" 탭 선택
3. 캘린더 뷰로 전환
4. 테스트 카드가 있는 날짜 클릭
5. Drawer가 열리고 테스트 카드가 리스트에 표시되는지 확인
6. 테스트 카드에 "테스트" 배지가 표시되는지 확인
7. 날짜 기준이 `scheduled_start_at`인지 확인 (요청자 시간 무시)

**예상 결과**:
- Drawer에 테스트 카드가 포함되어 표시됨
- 테스트 카드에 "테스트" 배지가 표시됨
- 날짜 필터링이 `scheduled_start_at` 기준으로 정확하게 작동함

---

### 시나리오 4: 다른 계정 영향 없음
**목표**: 다른 유저의 데이터에 영향을 주지 않는지 확인

**절차**:
1. 다른 계정으로 로그인
2. `/trips` 페이지 확인
3. `/my` 페이지의 제공 이력 캘린더 확인
4. 테스트 카드 마킹이 다른 계정에 영향을 주지 않는지 확인

**예상 결과**:
- 다른 계정의 데이터는 변경되지 않음
- 다른 계정의 화면은 정상적으로 작동함

---

### 시나리오 5: 활성 카드 정상 노출
**목표**: 일반 활성 카드가 제공하기 화면에서 정상적으로 표시되는지 확인

**절차**:
1. 새로운 픽업 그룹 생성 (`/trips/new`)
2. `/trips` 페이지에서 생성한 그룹이 표시되는지 확인
3. `/my` 페이지의 제공 이력 캘린더에서도 표시되는지 확인

**예상 결과**:
- 새로 생성한 활성 카드는 제공하기 화면에 정상 표시됨
- 마이페이지 캘린더에도 정상 표시됨

---

### 시나리오 6: 만료/무효 카드 기존 규칙 유지
**목표**: 만료/무효 카드가 기존 규칙대로 처리되는지 확인

**절차**:
1. 만료된 Trip (EXPIRED 상태) 확인
2. 완료된 Trip (COMPLETED 상태) 확인
3. 제공하기 화면에서 표시되지 않는지 확인
4. 마이페이지 캘린더 이력에는 표시되는지 확인

**예상 결과**:
- 만료/무효 카드는 제공하기 화면에서 숨김 처리됨
- 마이페이지 캘린더 이력에는 표시됨
- 기존 status 전이 로직이 정상 작동함

---

## 문제 해결

### 테스트 카드가 제공하기 화면에 여전히 보이는 경우
1. `is_test` 컬럼이 제대로 추가되었는지 확인
2. 테스트 카드 마킹 SQL이 실행되었는지 확인
3. `getMyTrips()` 함수에 `.eq('is_test', false)` 필터가 있는지 확인

### 테스트 카드가 마이페이지 캘린더에 보이지 않는 경우
1. `getMyProvideCalendarStats()` 함수에 `is_test` 필터가 없는지 확인
2. `getMyTripsIncludingTest()` 함수가 제대로 작동하는지 확인
3. `DateDetailDrawer`에서 `getMyTripsIncludingTest()`를 사용하는지 확인

### 날짜 기준이 잘못된 경우
1. `scheduled_start_at` 기준으로 필터링되는지 확인
2. 요청자 시간(`pickup_time`)이 아닌 그룹 시간(`scheduled_start_at`)을 사용하는지 확인

## 추가 확인 사항
- 브라우저 콘솔에 에러가 없는지 확인
- 네트워크 탭에서 API 호출이 정상인지 확인
- 데이터베이스 쿼리가 올바르게 실행되는지 확인
